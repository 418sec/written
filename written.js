(function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};this.Written=function(){function e(n,r){var i,o,s,u;null==r&&(r={}),this.toString=t(this.toString,this),this.redo=t(this.redo,this),this.undo=t(this.undo,this),this.render=t(this.render,this),this.linefeed=t(this.linefeed,this),this.cursor=t(this.cursor,this),this.changed=t(this.changed,this),this.changeTo=t(this.changeTo,this),this.dispatch=t(this.dispatch,this),n.instance=this,n.dataset.editor="written",this.element=function(){return n},this.element().addEventListener("dragover",this.over),this.element().addEventListener("drop",this.preventDefaults),this.element().addEventListener("keypress",this.linefeed),this.element().addEventListener("keydown",this.undo),this.element().addEventListener("keydown",this.redo),this.element().addEventListener("keydown",this.cursor),s=r.parsers,null==s&&(s=new e.Parsers),this.parsers=s,u=this.toString(),this.element().textContent="","true"!==this.element().contentEditable&&(this.element().contentEditable="true"),i=new e.Cursor(this.element(),window.getSelection(),this.parsers),o=new e.Document(u,this.parsers,i),this.render(o),o.cursor.focus(o.toString().length),this.history=new e.History(o),this.observer=new e.Observer(this.element(),this.changed),this.dispatch("written:initialized")}return e.prototype.preventDefaults=function(t){return t.preventDefault()},e.prototype.dispatch=function(t,e){var n;return null==e&&(e={}),n=new CustomEvent(t,{bubbles:!0,detail:e}),this.element().dispatchEvent(n)},e.prototype.changeTo=function(t){var n;return n=new e.Document(t,this.parsers),this.history.push(n),this.render(n)},e.prototype.changed=function(){var t,n,r;return r=this.history.current,t=new e.Cursor(this.element(),window.getSelection(),this.parsers),n=new e.Document(this.toString(),this.parsers,t),this.element().children.length>0&&0===r.toString().localeCompare(n.toString())?void 0:(this.history.push(n),this.render(n),this.dispatch("written:changed",{document:n}))},e.prototype.cursor=function(){return this.history.current.cursor=new e.Cursor(this.element(),window.getSelection(),this.parsers)},e.prototype.linefeed=function(t){var n;if(13===t.which)return t.preventDefault(),t.stopPropagation(),n=new e.Cursor(this.element(),window.getSelection(),this.parsers),this.observer.pause(function(t){return function(){var r,i,o;return o=n.offset,i=t.history.current.toString().split("\n").map(function(t){return t.length<o?o-=t.length:o>=0&&(t=[t.slice(0,o),"\n",t.slice(o)].join(""),o-=t.length),o-=1,t}),0===o&&(i.push(""),n.offset+=1),r=new e.Document(i.join("\n"),t.parsers,n),n.offset<r.toString().length&&(n.offset+=1),t.render(r),t.history.push(r)}}(this))},e.prototype.render=function(t){return t.applyTo(this.element()),e.Attachments.attach(this)},e.prototype.undo=function(t){var e;if("KeyZ"===t.code&&t.metaKey&&!t.shiftKey)return t.preventDefault(),t.stopPropagation(),(e=this.history.previous())?(this.history.current=e,this.render(e)):void 0},e.prototype.redo=function(t){var e;if("KeyZ"===t.code&&t.metaKey&&t.shiftKey)return t.preventDefault(),t.stopPropagation(),(e=this.history.next())?(this.history.current=e,this.render(this.history.current)):void 0},e.prototype.toString=function(){var t,e,n,r,i,o;for(o=[],i=this.element().childNodes,e=0,n=i.length;n>e;e++)r=i[e],t=this.parsers.toString(r).split("\n"),o.push(t.join("\n"));return o.join("\n")},e}()}).call(this),function(){var t,e,n=function(t,e){return function(){return t.apply(e,arguments)}};this.Written.Attachments=new(e=function(){function t(){this.attach=n(this.attach,this),this.attachments={},this.nodes=[]}return t.prototype.bind=function(t,e){return this.attachments[t]=e},t.prototype.attach=function(t){var e,n,r,i,o,s;o=this.attachments,s=[];for(n in o)e=o[n],i=t.element().querySelectorAll(n),s.push(function(){var n,o,s;for(s=[],n=0,o=i.length;o>n;n++)r=i[n],this.nodes.includes(r)||(e=new e(r),e.editor(t),s.push(this.nodes.push(r)));return s}.call(this));return s},t}()),this.Written.Attachments.Base=t=function(){function t(){this.resume=n(this.resume,this),this.pause=n(this.pause,this)}return t.prototype.editor=function(t){return this.editor=function(){return t},this.editor()},t.prototype.pause=function(){return this.editor().observer.pause()},t.prototype.resume=function(t){return this.editor().observer.resume(),null!=t?t():void 0},t.prototype.getSelection=function(){return window.getSelection()},t}()}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};Written.Cursor=function(){function e(e,n,r){this.focus=t(this.focus,this);var i,o,s,u,h,c,p;for(this.element=function(){return e},this.selection=n,this.parsers=r,o=Array.prototype.slice.call(this.element().children,0),this.offset=n.focusOffset,h=n.focusNode;h&&!o.includes(h);){if(c=h.parentElement){for(i=h.previousSibling;i;)this.offset+=this.parsers.toString(i).length,i=i.previousSibling;h instanceof HTMLLIElement&&(this.offset+=Array.prototype.indexOf.call(c.children,h))}h=c}for(p=this.element().children,s=0,u=p.length;u>s&&(i=p[s],i!==h);s++)this.offset+=this.parsers.toString(i).length,this.offset+=1;this.currentNode=function(){return h}}return e.prototype.offsetAt=function(t){var e,n;for(n=this.offset,e=this.element().firstElementChild;e&&e!==t;)n-=this.parsers.toString(e).length,e=e.nextElementSibling;return n},e.prototype.focus=function(t,e){var n;for(void 0===t?t=this.offset:this.offset=t,void 0===e&&(e=this.element().firstElementChild);e.nextElementSibling&&this.parsers.toString(e).length<t;)t-=this.parsers.toString(e).length+1,e=e.nextElementSibling;return n=this.parsers.getRange(e,Math.min(t,this.parsers.toString(e).length),document.createTreeWalker(e,NodeFilter.SHOW_TEXT)),this.offsetDiffersBetween(this.selection,n)&&(this.selection.removeAllRanges(),this.selection.addRange(n),!this.inViewport(e))?e.scrollIntoView():void 0},e.prototype.offsetDiffersBetween=function(t,e){return t.focusNode!==e.startContainer||t.focusOffset!==e.startOffset},e.prototype.inViewport=function(t){var e;return e=t.getBoundingClientRect(),e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)},e}()}.call(this),function(){this.Written.Parsers=function(){function t(t){var e,n,r,i,o,s,u,h;for(null==t&&(t={}),null!=t.blocks?this.blocks=Written.Parsers.Blocks.select(t.blocks):this.blocks=[Written.Parsers.Blocks["default"]].concat(Written.Parsers.Blocks),null!=t.inlines?this.inlines=Written.Parsers.Inlines.select(t.inlines):this.inlines=Written.Parsers.Inlines,this.nodes={},s=this.blocks.concat(this.inlines),e=0,r=s.length;r>e;e++)for(h=s[e],u=h.nodes,n=0,i=u.length;i>n;n++)o=u[n],this.nodes[o]=h;this.blocks.parse=this.parseBlocks.bind(this,this.blocks),this.inlines.parse=this.parseInlines.bind(this,this.inlines)}return t.prototype.parse=function(t,e){return t.parse(e)},t.prototype.parseBlocks=function(t,e){var n,r,i,o,s;for(t=[t["default"]].concat(t).reverse(),r=[],o=e.split("\n").reverse();void 0!==(i=o.pop());)s=i,n=r[r.length-1],null!=n&&n.multiline&&n.accepts(i)?n.append(i):r.push(this.find(t,s));return r},t.prototype.parseInlines=function(t,e){var n,r,i,o,s,u,h,c,p;for(n="",r=[],h=[],o=0,i=0,s=t.length;s>i;i++)for(p=t[i],p.rule.lastIndex=0;u=p.rule.exec(e);)c=new p.parser(u),h[c.index()]=c;for(;null!=e[o];)(c=h[o])?(r.push(n.slice(0)),r.push(c),n="",o+=c.length()):(n+=e[o],o+=1);return n.length>0&&r.push(n),r},t.prototype.find=function(t,e){var n,r,i,o,s;for(o=void 0,n=0,r=t.length;r>n;n++)if(s=t[n],i=s.rule.exec(e)){o=new s.parser(i);break}return o},t.prototype.get=function(t){return this.nodes[t]},t.prototype.getRange=function(t,e,n){return this.nodes[t.nodeName.toLowerCase()].getRange(t,e,n)},t.prototype.toString=function(t){var e;return e=this.nodes[t.nodeName.toLowerCase()],null!=e?e.toString(t):t.textContent},t}(),Written.Parsers.Blocks=[],Written.Parsers.Inlines=[],Written.Parsers.Blocks.select=function(t){var e;return e=[],t.map(function(t){var n;return n=Written.Parsers.Blocks.find(function(e){return e.name===t}),null!=n?e.push(n):void 0}),[Written.Parsers.Blocks["default"]].concat(e)},Written.Parsers.Inlines.select=function(t){var e;return e=[],t.map(function(t){var n;return n=Written.Parsers.Inlines.find(function(e){return e.name===t}),null!=n?e.push(n):void 0}),e},Written.Parsers.register=function(t){var e;if(e=void 0,"block"===t.type)e=Written.Parsers.Blocks;else{if("inline"!==t.type)return void raise('error: Written.Parsers can either be "block" or "inline"');e=Written.Parsers.Inlines}return Written.Parsers.normalize(t),t["default"]?e["default"]=t:e.push(t)},Written.Parsers.normalize=function(t){return t.getRange||(t.getRange=function(t,e,n){var r;if(r=document.createRange(),null==t.firstChild)r.setStart(t,0);else for(;n.nextNode();){if(!(n.currentNode.length<e)){r.setStart(n.currentNode,e);break}e-=n.currentNode.length}return r.collapse(!0),r}),Object.prototype.toString===t.toString?t.toString=function(t){return t.textContent}:void 0},Written.Parsers.Block=function(){function t(){}return t.prototype.outerText=function(){throw"method implementation: "+this.name+".outerText() is missing."},t.prototype.equals=function(){throw"method implementation: "+this.name+".equals(current, rendered) is missing."},t.prototype.toEditor=function(){throw"method implementation: "+this.name+".toEditor() is missing."},t.prototype.toHTML=function(){throw"method implementation: "+this.name+".toHTML() is missing."},t}(),Written.Parsers.Inline=function(){function t(){}return t.prototype.index=function(){throw"method implementation: "+this.name+".index() is missing."},t.prototype.length=function(){throw"method implementation: "+this.name+".length() is missing."},t.prototype.toEditor=function(){throw"method implementation: "+this.name+".toEditor() is missing."},t.prototype.toHTML=function(){throw"method implementation: "+this.name+".toHTML() is missing."},t}()}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};Written.Document=function(){function e(e,n,r){this.toString=t(this.toString,this),this.applyTo=t(this.applyTo,this),this.toHTMLString=t(this.toHTMLString,this),this.freeze=t(this.freeze,this),this.cursor=r,this.blocks=n.parse(n.blocks,e),this.blocks.forEach(function(){return function(t){return null!=t.innerText?t.multiline?t.content=t.innerText().split("\n").map(function(t){return n.parse(n.inlines,t)}):t.content=n.parse(n.inlines,t.innerText()):void 0}}(this))}return e.prototype.freeze=function(){return Object.freeze(this.blocks),Object.freeze(this.cursor)},e.prototype.toHTMLString=function(){var t;return t="",this.blocks.forEach(function(e){return t+=e.toHTML().outerHTML+"\n"}),t},e.prototype.applyTo=function(t){var e,n,r,i,o,s,u,h,c,p,a;for(p=this.blocks,o=i=0,u=p.length;u>i;o=++i)e=p[o],a=Array.prototype.slice.call(t.children,o),n=a[0],c=this.findNodeFor(e,a),t.insertBefore(c,n);for(r=Array.prototype.slice.call(t.children,o),s=0,h=r.length;h>s;s++)n=r[s],n.remove();return this.cursor.focus()},e.prototype.findNodeFor=function(t,e){var n,r;return r=t.toEditor(),n=e.find(function(e){return t.equals(e,r)}),n||r},e.prototype.toString=function(){var t;return null!=this.toString.cache?this.toString.cache:(t=this.blocks.map(function(t){return t.outerText()}),t.join("\n"))},e}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};Written.History=t=function(){function t(t){this.limit=e(this.limit,this),this.next=e(this.next,this),this.previous=e(this.previous,this),this.push=e(this.push,this),t.freeze(),this.current=t}return t.prototype.push=function(t){var e;return e=this.current,this.current=t,e.nextDocument=t,t.previousDocument=e,t.freeze(),this.limit()},t.prototype.previous=function(){return this.current.previousDocument},t.prototype.next=function(){return this.current.nextDocument},t.prototype.limit=function(){var t,e,n;for(t=this.current,e=n=0;1e3>n&&null!=t.previousDocument;e=++n)t=t.previousDocument;return t.previousDocument=void 0},t}()}.call(this),function(){Written.toHTML=function(t){var e;return e=document.createElement("div"),e.innerHTML=t,e.children.length>1?e.children:e.children[0]}}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};Written.Observer=function(){function e(e,n){this.pause=t(this.pause,this),this.resume=t(this.resume,this),this.normalize=t(this.normalize,this),this.element=function(){return e},this.settings=function(){return{childList:!0,subtree:!0,characterData:!0}},this.mutations=new MutationObserver(this.normalize.bind(this,n)),this.mutations.observe(this.element(),this.settings())}return e.prototype.normalize=function(t,e){return this.pause(function(){return function(){var t,n,r,i,o;for(o=[],r=0,i=e.length;i>r;r++)n=e[r],n.target instanceof HTMLElement?o.push(function(){var e,r,i,o;for(i=n.target.querySelectorAll("br"),o=[],e=0,r=i.length;r>e;e++)t=i[e],o.push(t.remove());return o}()):o.push(void 0);return o}}(this)),this.pause(t)},e.prototype.resume=function(){return this.mutations.observe(this.element(),this.settings())},e.prototype.pause=function(t){return this.mutations.disconnect(),null!=t?(t(),this.resume()):void 0},e}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n=function(t,e){function n(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},r={}.hasOwnProperty;t=function(t){function r(t){this.toHTML=e(this.toHTML,this),this.toEditor=e(this.toEditor,this),this.matches=[t],this.content="\n",this.opened=!0}return n(r,t),r.prototype.multiline=!0,r.prototype.outerText=function(){var t;return t=this.matches.map(function(t){return t[0]}),t.join("\n")},r.prototype.accepts=function(){return this.opened},r.prototype.append=function(t){var e;return e=/^(~{3})$/i.exec(t),null!=e?(this.matches.push(e),this.opened=!1):(this.matches.push([t]),this.content+=t+"\n"),this.content},r.prototype.equals=function(t,e){return t.outerHTML===e.outerHTML},r.prototype.toEditor=function(){var t,e;return e=Written.toHTML("<pre><code></code></pre>"),t=e.querySelector("code"),null!=this.matches[0][3]&&t.classList.add("language-"+this.matches[0][3]),t.appendChild(document.createTextNode(this.content)),null!=this.highlight&&this.highlight(t),t.insertAdjacentHTML("afterbegin",this.matches[0][0]),this.opened||t.insertAdjacentHTML("beforeend",this.matches[this.matches.length-1][0]),e},r.prototype.toHTML=function(){var t,e;return e=Written.toHTML("<pre><code></code></pre>"),t=e.querySelector("code"),null!=this.matches[0][3]&&t.classList.add("language-"+this.matches[0][3]),null!=this.matches[0][4]&&t.insertAdjacentHTML("beforebegin","<header>"+this.matches[0][4]+"</header>"),t.appendChild(document.createTextNode(this.content.slice(1,-1))),e},r}(Written.Parsers.Block),Written.Parsers.register({parser:t,name:"code",nodes:["pre"],type:"block",rule:/^((~{3})([a-z]+)?)(?:\s(.*))?/i,toString:function(t){return"\n"===t.textContent[t.textContent.length-1]?t.textContent.substr(0,t.textContent.length-1):t.textContent},highlightWith:function(e){return t.prototype.highlight=e}})}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n=function(t,e){function n(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},r={}.hasOwnProperty;t=function(t){function r(t){this.toHTML=e(this.toHTML,this),this.toEditor=e(this.toEditor,this),this.match=t}return n(r,t),r.prototype.multiline=!1,r.prototype.equals=function(t,e){return t.outerHTML===e.outerHTML},r.prototype.innerText=function(){return this.match[3]},r.prototype.outerText=function(){return this.match[0]},r.prototype.toEditor=function(){var t,e,n,r,i;for(n=Written.toHTML("<h"+this.match[2].length+">"),r=this.content,t=0,e=r.length;e>t;t++)i=r[t],null!=i.toEditor?n.appendChild(i.toEditor()):n.appendChild(document.createTextNode(i));return n.insertAdjacentHTML("afterbegin",this.match[1]),n},r.prototype.toHTML=function(){var t,e,n,r,i;for(n=Written.toHTML("<h"+this.match[2].length+">"),r=this.content,t=0,e=r.length;e>t;t++)i=r[t],null!=i.toHTML?n.appendChild(i.toHTML()):n.appendChild(document.createTextNode(i));return n},r}(Written.Parsers.Block),Written.Parsers.register({parser:t,name:"header",nodes:["h1","h2","h3","h4","h5","h6"],type:"block",rule:/^((#{1,6})\s)(.*)$/i,getRange:function(t,e,n){var r;if(r=document.createRange(),null==t.firstChild)r.setStart(t,0);else for(;n.nextNode();){if(!(n.currentNode.length<e)){r.setStart(n.currentNode,e);break}e-=n.currentNode.length}return r.collapse(!0),r},toString:function(t){return t.textContent}})}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n=function(t,e){function n(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},r={}.hasOwnProperty;t=function(t){function r(t){this.placeholder=e(this.placeholder,this),this.toEditor=e(this.toEditor,this),this.match=t}return n(r,t),r.prototype.multiline=!1,r.prototype.outerText=function(){return this.match[0]},r.prototype.innerText=function(){return this.match[2]},r.prototype.equals=function(t,e){var n,r;return n=t.querySelector("figcaption")||{},r=t.querySelector("img")||{},e.querySelector("figcaption").outerHTML===n.outerHTML&&e.querySelector("img").src===r.src},r.prototype.toEditor=function(){var t,e,n,r,i,o,s,u;for(n=Written.toHTML("<figure><div contenteditable='false'><img/></div><figcaption /></figure>"),t=n.querySelector("figcaption"),e=n.querySelector("div"),s=this.content,r=0,o=s.length;o>r;r++)u=s[r],null!=u.toEditor?t.appendChild(u.toEditor()):t.appendChild(document.createTextNode(u));return t.insertAdjacentHTML("afterbegin","!["),t.insertAdjacentHTML("beforeend","]"),t.insertAdjacentHTML("beforeend",this.match[3]),i=n.querySelector("img"),null!=this.match[4]?i.src=this.match[4]:i.src="/assets/written/placeholder.png",n},r.prototype.toHTML=function(){var t,e,n,r,i,o,s;for(e=Written.toHTML("<figure><img/><figcaption /></figure>"),r=e.querySelector("img"),t=e.querySelector("figcaption"),r.src=this.match[4],o=this.content,n=0,i=o.length;i>n;n++)s=o[n],null!=s.toHTML?t.appendChild(s.toHTML()):t.appendChild(document.createTextNode(s));return e},r.prototype.placeholder=function(t,e,n){return null==n&&(n=!1),t.src="/assets/written/placeholder.png",t.onerror=void 0},r}(Written.Parsers.Block),Written.Parsers.register({parser:t,name:"image",nodes:["figure"],type:"block",rule:/^(!{1}\[([^\]]*)\])(\(([^\s]*)?\))$/i,toString:function(t){return(t.querySelector("figcaption")||t).textContent}})}.call(this),function(){var t,e,n=function(t,e){return function(){return t.apply(e,arguments)}},r=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},i={}.hasOwnProperty;e=/^(\d+\.\s)(.*)/i,t=function(t){function i(t){this.toHTML=n(this.toHTML,this),this.toEditor=n(this.toEditor,this),this.matches=[t],this.opened=!0}return r(i,t),i.prototype.multiline=!0,i.prototype.accepts=function(t){return this.opened=e.test(t),this.opened},i.prototype.append=function(t){return this.matches.push(e.exec(t))},i.prototype.equals=function(t,e){return t.outerHTML===e.outerHTML},i.prototype.innerText=function(){var t;return t=this.matches.map(function(t){return t[2]}),t.join("\n")},i.prototype.outerText=function(){var t;return t=this.matches.map(function(t){return t[0]}),t.join("\n")},i.prototype.toEditor=function(){var t,e,n,r,i,o,s,u,h,c;for(u=Written.toHTML("<ol></ol>"),h=this.content,e=t=0,r=h.length;r>t;e=++t){for(s=h[e],o=Written.toHTML("<li>"),o.appendChild(document.createTextNode(this.matches[e][1])),n=0,i=s.length;i>n;n++)c=s[n],null!=c.toEditor?o.appendChild(c.toEditor()):o.appendChild(document.createTextNode(c.toString()));u.appendChild(o)}return u},i.prototype.toHTML=function(){var t,e,n,r,i,o,s,u,h,c;for(u=Written.toHTML("<ol></ol>"),h=this.content,e=t=0,r=h.length;r>t;e=++t){for(s=h[e],o=Written.toHTML("<li>"),n=0,i=s.length;i>n;n++)c=s[n],null!=c.toHTML?o.appendChild(c.toHTML()):o.appendChild(document.createTextNode(c.toString()));u.appendChild(o)}return u},i}(Written.Parsers.Block),Written.Parsers.register({parser:t,name:"olist",nodes:["ol"],type:"block",rule:e,getRange:function(t,e,n){var r,i,o;if(o=document.createRange(),null==t.firstChild)return void o.setStart(t,0);for(r=t.firstElementChild;n.nextNode();){if(!r.contains(n.currentNode)){for(i=n.currentNode;null!=i&&!(i instanceof HTMLLIElement);)i=i.parentElement;r=i,e--}{if(!(n.currentNode.length<e)){o.setStart(n.currentNode,e);break}e-=n.currentNode.length}}return o.collapse(!0),o},toString:function(t){var e;return e=Array.prototype.slice.call(t.children).map(function(t){return t.textContent}),e.join("\n")}})}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n=function(t,e){function n(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},r={}.hasOwnProperty;t=function(t){function r(t){this.toHTML=e(this.toHTML,this),this.toEditor=e(this.toEditor,this),this.outerText=e(this.outerText,this),this.innerText=e(this.innerText,this),this.match=t}return n(r,t),r.prototype.multiline=!1,r.prototype.equals=function(t,e){return t.outerHTML===e.outerHTML},r.prototype.innerText=function(){return this.match[0]},r.prototype.outerText=function(){return this.match[0]},r.prototype.toEditor=function(){var t,e,n,r,i;for(n=Written.toHTML("<p>"),r=this.content,t=0,e=r.length;e>t;t++)i=r[t],null!=i.toEditor?n.appendChild(i.toEditor()):n.appendChild(document.createTextNode(i));return n},r.prototype.toHTML=function(){var t,e,n,r,i;for(n=Written.toHTML("<p>"),r=this.content,t=0,e=r.length;e>t;t++)i=r[t],null!=i.toHTML?n.appendChild(i.toHTML()):n.appendChild(document.createTextNode(i));return n},r}(Written.Parsers.Block),Written.Parsers.register({parser:t,name:"paragraph",nodes:["p"],type:"block",rule:/.*/i,"default":!0})}.call(this),function(){var t,e,n=function(t,e){return function(){return t.apply(e,arguments)}},r=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},i={}.hasOwnProperty;e=/^(>\s)(.*)/i,t=function(t){function i(t){this.toHTML=n(this.toHTML,this),this.toEditor=n(this.toEditor,this),this.innerText=n(this.innerText,this),this.matches=[t],this.opened=!0}return r(i,t),i.prototype.multiline=!0,i.prototype.accepts=function(t){return this.opened=e.test(t)},i.prototype.append=function(t){return this.matches.push(e.exec(t))},i.prototype.outerText=function(){var t;return t=this.matches.map(function(t){return t[0]}),t.join("\n")},i.prototype.innerText=function(){var t;return t=this.matches.map(function(t){return t[2]}),t.join("\n")},i.prototype.equals=function(t,e){return t.outerHTML===e.outerHTML},i.prototype.toEditor=function(){var t,e,n,r,i,o,s,u,h,c;for(s=Written.toHTML("<blockquote></blockquote>"),h=this.content,e=t=0,r=h.length;r>t;e=++t){for(o=h[e],u=Written.toHTML("<p>"),u.appendChild(document.createTextNode(this.matches[e][1])),n=0,i=o.length;i>n;n++)c=o[n],null!=c.toEditor?u.appendChild(c.toEditor()):u.appendChild(document.createTextNode(c.toString()));e<this.content.length-1&&u.insertAdjacentHTML("beforeend","\n"),s.appendChild(u)}return s},i.prototype.toHTML=function(){var t,e,n,r,i,o,s,u,h,c;for(s=Written.toHTML("<blockquote></blockquote>"),h=this.content,e=t=0,r=h.length;r>t;e=++t){for(o=h[e],u=Written.toHTML("<p>"),n=0,i=o.length;i>n;n++)c=o[n],null!=c.toHTML?u.appendChild(c.toHTML()):u.appendChild(document.createTextNode(c.toString()));e<this.content.length-1&&u.insertAdjacentHTML("beforeend","\n"),s.appendChild(u)}return s},i}(Written.Parsers.Block),Written.Parsers.register({parser:t,name:"quote",nodes:["blockquote"],type:"block",rule:e})}.call(this),function(){var t,e,n=function(t,e){return function(){return t.apply(e,arguments)}},r=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},i={}.hasOwnProperty;t=/^(-\s)(.*)/i,e=function(e){function i(t){this.toHTML=n(this.toHTML,this),this.toEditor=n(this.toEditor,this),this.matches=[t]}return r(i,e),i.prototype.multiline=!0,i.prototype.accepts=function(e){return this.opened=t.test(e),this.opened},i.prototype.outerText=function(){var t;return t=this.matches.map(function(t){return t[0]}),t.join("\n")},i.prototype.innerText=function(){var t;return t=this.matches.map(function(t){return t[2]}),t.join("\n")},i.prototype.append=function(e){return this.matches.push(t.exec(e))},i.prototype.equals=function(t,e){return t.outerHTML===e.outerHTML},i.prototype.toEditor=function(){var t,e,n,r,i,o,s,u,h,c;for(u=Written.toHTML("<ul></ul>"),h=this.content,e=t=0,r=h.length;r>t;e=++t){for(s=h[e],o=Written.toHTML("<li>"),o.appendChild(document.createTextNode(this.matches[e][1])),n=0,i=s.length;i>n;n++)c=s[n],null!=c.toEditor?o.appendChild(c.toEditor()):o.appendChild(document.createTextNode(c.toString()));u.appendChild(o)}return u},i.prototype.toHTML=function(){var t,e,n,r,i,o,s,u,h,c;for(u=Written.toHTML("<ul></ul>"),h=this.content,e=t=0,r=h.length;r>t;e=++t){for(s=h[e],o=Written.toHTML("<li>"),n=0,i=s.length;i>n;n++)c=s[n],null!=c.toHTML?o.appendChild(c.toHTML()):o.appendChild(document.createTextNode(c.toString()));u.appendChild(o)}return u},i}(Written.Parsers.Block),Written.Parsers.register({parser:e,name:"ulist",nodes:["ul"],type:"block",rule:t,getRange:function(t,e,n){var r,i,o;if(o=document.createRange(),null==t.firstChild)return void o.setStart(t,0);for(r=t.firstElementChild;n.nextNode();){if(!r.contains(n.currentNode)){for(i=n.currentNode;null!=i&&!(i instanceof HTMLLIElement);)i=i.parentElement;r=i,e--}{if(!(n.currentNode.length<e)){o.setStart(n.currentNode,e);break}e-=n.currentNode.length}}return o.collapse(!0),o},toString:function(t){var e;return e=Array.prototype.slice.call(t.children).map(function(t){return t.textContent}),e.join("\n")}})}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n=function(t,e){function n(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},r={}.hasOwnProperty;t=function(t){function r(t){this.toHTML=e(this.toHTML,this),this.toEditor=e(this.toEditor,this),this.length=e(this.length,this),this.index=e(this.index,this),this.match=t}return n(r,t),r.prototype.index=function(){return this.match.index},r.prototype.length=function(){return this.match[0].length},r.prototype.toEditor=function(){return Written.toHTML("<strong>"+this.match[0]+"</strong>")},r.prototype.toHTML=function(){return Written.toHTML("<strong>"+this.match[3]+"</strong>")},r}(Written.Parsers.Inline),Written.Parsers.register({parser:t,name:"bold",nodes:["strong"],type:"inline",rule:/((\*{1})([^\*]+)(\*{1}))/gi})}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n=function(t,e){function n(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},r={}.hasOwnProperty;t=function(t){function r(t){this.toHTML=e(this.toHTML,this),this.toEditor=e(this.toEditor,this),this.length=e(this.length,this),this.index=e(this.index,this),this.match=t}return n(r,t),r.prototype.index=function(){return this.match.index},r.prototype.length=function(){return this.match[0].length},r.prototype.toEditor=function(){var t;return t=Written.toHTML("<code></code>"),t.textContent=this.match[0],null!=this.match[3]&&t.classList.add("language-"+this.match[3]),null!=this.highlight&&this.highlight(t),t},r.prototype.toHTML=function(){var t;return t=Written.toHTML("<code>"+this.match[4]+"</code>"),null!=this.match[3]&&t.classList.add("language-"+this.match[3]),t},r}(Written.Parsers.Inline),Written.Parsers.register({parser:t,name:"code",nodes:["code"],type:"inline",rule:/((~{3})([a-z]+)?)\s(.+)?(~{3})/gi,highlightWith:function(e){return t.prototype.highlight=e}})}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n=function(t,e){function n(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},r={}.hasOwnProperty;t=function(t){function r(t){this.toEditor=e(this.toEditor,this),this.length=e(this.length,this),this.index=e(this.index,this),this.match=t}return n(r,t),r.prototype.index=function(){return this.match.index},r.prototype.length=function(){return this.match[0].length},r.prototype.toEditor=function(){return Written.toHTML("<em>"+this.match[1]+"</em>")},r.prototype.toHTML=function(){return Written.toHTML("<em>"+this.match[3]+"</em>")},r}(Written.Parsers.Inline),Written.Parsers.register({parser:t,name:"italic",nodes:["em"],type:"inline",rule:/((_{1})([^_]+)(_{1}))/gi})}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n=function(t,e){function n(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},r={}.hasOwnProperty;t=function(t){function r(t){this.toHTML=e(this.toHTML,this),this.toEditor=e(this.toEditor,this),this.length=e(this.length,this),this.index=e(this.index,this),this.match=t}return n(r,t),r.prototype.index=function(){return this.match.index},r.prototype.length=function(){return this.match[0].length},r.prototype.toEditor=function(){return Written.toHTML("<a><strong>"+this.match[1]+"</strong>"+this.match[3]+"</a>")},r.prototype.toHTML=function(){return Written.toHTML("<a href='"+this.match[4]+"'>"+this.match[2]+"</a>")},r}(Written.Parsers.Inline),Written.Parsers.register({parser:t,name:"link",nodes:["a"],type:"inline",rule:/!{0}(\[([^\]]+)\])(\(([^\)]+)\))/gi})}.call(this),function(){}.call(this);